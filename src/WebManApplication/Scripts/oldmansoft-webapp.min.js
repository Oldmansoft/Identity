if(!window.oldmansoft){window.oldmansoft={}}window.oldmansoft.webapp=new (function(){var h=this,o={timeover:180000,loading_show_time:1000,loading_hide_time:200,server_charset:"utf-8"},b={ok:"Ok",yes:"Yes",no:"No",loading:"Loading",load_layout_error:"load layout error, click Ok to reload."},x=null,A=null,F=null,i=null,a=function(){return false},y=null,D=true,g=true,k=null,j=[],E=null,s=null,t,d,r,z,e=true,q=false;function B(I){if(!I){return""}return I.replace(/\$/g,"$24").replace(/~/g,"$7e").replace(/#/g,"$23").replace(/\//g,"$2f").replace(/\?/g,"$3f")}function c(I){if(!I){return""}return I.replace(/\$7e/g,"~").replace(/\$23/g,"#").replace(/\$2f/g,"/").replace(/\$3f/g,"?").replace(/\$24/g,"$")}function w(K){var J=[],I,M;function L(N){if(!N){return""}if(N.substr(0,1)=="#"){return N.substr(1)}return N}if(K instanceof Array){J=K.slice()}else{I=L(K);if(I.indexOf("#")>-1||I.indexOf("%23")>-1){J=I.replace(/%23/g,"#").split("#")}else{J=I.split("~");for(M=0;M<J.length;M++){J[M]=c(J[M])}}}this.getLinks=function(){return J.slice()};this.push=function(N){return J.push(L(N))};this.pop=function(){return J.pop()};this.last=function(){return J[J.length-1]};this.getContent=function(){var N=[],O;for(O=0;O<J.length;O++){N.push(B(J[O]))}return N.join("~")}}function v(L,N,J){var K,I,M;if(L==""){L=J}K=L.indexOf("&");if(K>-1){I=L.indexOf("?");if(I==-1||K<I){L=L.substr(0,K)}}if(L.substr(0,1)=="/"){return L}if(!N){N=document.location.pathname}else{I=N.indexOf("?");if(I>-1){N=N.substr(0,I)}K=N.indexOf("&");if(K>-1){N=N.substr(0,K)}}M=N.split("/");M.pop();return M.join("/")+"/"+L}function f(L,J,I){for(var K=J;K>-1;K--){if(L[K]==""&&I.substr(0,1)=="/"){return I}if(L[K].substr(0,1)=="/"){return L[K]}}return null}function n(J){var I,K;if(!J){return false}for(I=0;I<J.length;I++){K=J.substr(I,1);if(K==" "){continue}if(K=="\r"){continue}if(K=="\n"){continue}if(K=="\t"){continue}break}if(J.substr(I,15)=="<!DOCTYPE html>"){return true}if(J.substr(I,5)=="<html"){return true}return false}this.scriptLoader=new function(){var K=[];function J(N,M,L){if(N.length==M+1){L.resolve()}else{I(N,M+1,L)}}function I(N,M,L){if(K[N[M]]){J(N,M,L);return}$.getScript(N[M],function(){K[N[M]]=true;J(N,M,L)})}this.load=function(){var L=$.Deferred();if(arguments.length==0){L.resolve()}else{I(arguments,0,L)}return L}};this.bodyManagement=new function(){var I=0;this.expand=function(){if(I==0){$("body").addClass("layout-expanded");if(k){k.hide()}}I++};this.shrink=function(){I--;if(I==0){$("body").removeClass("layout-expanded");if(k){k.show()}}if(I<0){throw"shrink error"}}};this.scrollbar=function(ac){if(!ac){return}var V,X,R,U,M,K,ad,P,T,O,ab=true;function J(ae,af){if(ae.selector=="body"){if(af!=undefined){$(document).scrollTop(af)}else{return $(document).scrollTop()}}else{if(af!=undefined){ae.scrollTop(af)}else{return ae.scrollTop()}}}function I(ag){var af,ae;isSetTrackPosition=false;this.contentHeight=function(){return af};this.viewHeight=function(){return ae};this.setHeight=function(){af=ag.scrollHeight;ae=window.innerHeight};this.setTrackPosition=function(ah){if(isSetTrackPosition){return true}ah.css("right",0);ah.css("top",0);isSetTrackPosition=true;return true};this.bindMouseWheel=function(){$(window).on("mousewheel",S)};this.unbindMouseWheel=function(){$(window).off("mousewheel",S)}}function Y(ah,ag){var af,ae;this.contentHeight=function(){return af};this.viewHeight=function(){return ae};this.setHeight=function(){af=ag.scrollHeight;ae=ah.innerHeight()};this.setTrackPosition=function(){return false};this.bindMouseWheel=function(){ah.on("mousewheel",S)};this.unbindMouseWheel=function(){ah.off("mousewheel",S)}}function aa(){var ae=(X.viewHeight()-ad)*J(ac)/(X.contentHeight()-X.viewHeight());K.css("top",ae)}function S(ah){var ag=ah.target,ai=ah.originalEvent.wheelDelta,af,ae;while(ag!=ah.currentTarget&&ag!=null&&ag.tagName!="HTML"&&ag.tagName!="BODY"){ae=ag.style.overflowY;if((ae=="auto"||ae=="scroll")&&ag.clientHeight!=ag.scrollHeight){if(ai>0&&ag.scrollTop>0){return true}if(ai<0&&ag.scrollTop+ag.clientHeight<ag.scrollHeight){return true}}ag=ag.parentElement}if(X.contentHeight()<=X.viewHeight()){return true}af=J(ac);if(ai<0){if(af>=(X.contentHeight()-X.viewHeight())){return true}}else{if(af==0){return true}}J(ac,af-ai);aa();return false}function N(){return false}function Q(ae){O=ae.clientY;T=J(ac);P.on("selectstart",N);P.on("mousemove",L);P.on("mouseup",W);U.addClass("focus")}function W(){P.off("selectstart",N);P.off("mousemove",L);P.off("mouseup",W);U.removeClass("focus")}function L(af){var ae=(X.contentHeight()-X.viewHeight())/(X.viewHeight()-ad);J(ac,T-(O-af.clientY)*ae);aa()}function Z(){X.setHeight();if(X.viewHeight()==0||X.contentHeight()<=X.viewHeight()){U.hide();return}else{U.show()}U.height(X.viewHeight());if(!X.setTrackPosition(U)){U.css("left",ac.innerWidth()-parseInt(ac.css("padding-left"))-M);U.css("top",-parseInt(ac.css("padding-top")))}ad=U.height()*X.viewHeight()/X.contentHeight();if(ad<20){ad=20}K.height(ad);aa()}ac=$(ac);V=ac.get(0);X=V.tagName=="BODY"?new I(V):new Y(ac,V);P=$("html");ac.css("overflow","hidden");R=$("<div></div>").addClass("scrollbar-container");U=$("<div></div>").addClass("scrollbar-track");K=$("<div></div>").addClass("scrollbar-arrow");R.append(U);U.append(K);ac.prepend(R);M=U.width();Z();j.push(this);U.mousedown(Q);$(window).on("resize",Z);X.bindMouseWheel();this.show=function(){if(ab){return}R.show();X.bindMouseWheel();ab=true};this.hide=function(){if(!ab){return}X.unbindMouseWheel();R.hide();ab=false};this.reset=function(){Z()}};this.resetScrollbar=function(){for(var I=0;I<j.length;I++){j[I].reset()}};this.resetWindowScrollbar=function(){if(k){k.reset();return}if(E==null){E="ontouchmove" in document}if(!E&&g){k=new h.scrollbar("body");setInterval(k.reset,500)}};function u(){this.load=function(){};this.unload=function(){};this.active=function(){};this.inactive=function(){}}function H(J,I,K){this.node=J;this.name=I;this.level=K}function p(){var I=[];function J(L,S,K,R){var Q,O=true,N=0,P=0,M;this.link=S;this.node=$("<div></div>").addClass(L+"-view").data("link",S);this.valid=false;Q=new H(this.node,L,K);this.hide=function(){if(!this.valid||!O){return}var T=$(window);N=T.scrollTop();P=T.scrollLeft();s.inactive(Q,M.inactive(Q));this.node.hide();O=false};this.callLoadAndActive=function(){s.load(Q,M.load(Q));s.active(Q,M.active(Q))};this.callInactiveAndUnload=function(){s.inactive(Q,M.inactive(Q));s.unload(Q,M.unload(Q))};this.remove=function(){this.node.remove();if(!this.valid){return}this.callInactiveAndUnload();this.node=null;this.valid=false;M=null};this.show=function(){if(!this.valid||O){return}this.node.show();s.active(Q,M.active(Q));$(window).scrollLeft(P);$(window).scrollTop(N);O=true};this.activeEvent=function(){if(!M){return}s.active(Q,M.active(Q))};this.inactiveEvent=function(){if(!M){return}s.inactive(Q,M.inactive(Q))};this.setContext=function(){y=new u();if(arguments.length==1){this.node.html(arguments[0])}else{this.node.empty();for(var T=0;T<arguments.length;T++){this.node.append(arguments[T])}}M=y;this.valid=true};this.getOption=function(){return R}}this.push=function(K,M,L){I.push(new J(K,M,this.count()+1,L))};this.pop=function(){return I.pop()};this.last=function(){return I[I.length-1]};this.like=function(K){if(I.length==0){return false}for(var L=0;L<I.length;L++){if(K.length==L){break}if(I[L].link!=K[L]){return false}}return true};this.count=function(){return I.length};this.get=function(K){return I[K]};this.replace=function(L,K,O,N){var M=new J(K,O,L+1,N);I[L].node.after(M.node);I[L].remove();I[L]=M};this.getBackLink=function(){var K=new w(this.getLinks());K.pop();return K.getContent()};this.getLink=function(){var K=new w(this.getLinks());return K.getContent()};this.getLinks=function(){var K=[],L;for(L=0;L<I.length;L++){K.push(I[L].link)}return K}}this.box=function(O,N){var L=false,K,J,P=[],M=null;function Q(S,R){if(S&&S.target!=S.currentTarget){return}K.stop(true);K.fadeOut(P.length>0?0:200,function(){h.bodyManagement.shrink();if(M==null){if(R){R()}return}if(M.close){M.close()}M.node.remove();if(P.length>0){M=P.pop();J.append(M.node);K.stop(true,true);K.fadeIn(0);if(R){R()}return}M=null;if(R){R()}})}function I(){if(L){return}L=true;K=$("<div></div>").addClass(O).addClass("box-background");if(N){J=$("<div></div>").addClass("layout-horizontal");K.append(J);K.append($("<div></div>").addClass("layout-vertical"))}else{J=K}K.prependTo($("body"))}this.open=function(R,S){I();if(M){if(M.node.data("type")=="message"){throw"not allow show again after message show."}P.push({node:M.node.detach(),close:M.close})}h.bodyManagement.expand();M={node:R,close:S};J.append(R);K.stop(true,true);K.fadeIn(200)};this.close=function(S,R){Q(S,R)};this.clear=function(){if(!M){return}h.bodyManagement.shrink();if(M.close){M.close()}M.node.remove();while(P.length>0){M=P.pop();J.append(M.node);h.bodyManagement.shrink();if(M.close){M.close()}M.node.remove()}M=null;K.hide()}};i=new function(){var J,I=[];this.push=function(K){I.push(J);J=K};this.get=function(){return J};this.pop=function(){if(I.length==1){throw"error call"}J=I.pop();return J}};d=new h.box("dialog-background",true);r=new h.box("window-background");z=new function(){var O=false,J,I=[],M=null;function N(Q,P){if(Q&&Q.target!=Q.currentTarget){return}M.node.stop(true);M.node.fadeOut(I.length>0?0:200,function(){h.bodyManagement.shrink();if(M==null){if(P){P()}return}if(M.close){M.close()}M.node.remove();if(I.length>0){M=I.pop();M.node.stop(true,true);M.node.fadeIn(0);if(P){P()}return}M=null;if(P){P()}})}function K(){if(O){return}O=true;J=$("<div></div>").addClass("modal-areas");J.prependTo($("body"))}function L(R){var Q,P;Q=$("<div></div>").addClass("modal-background").addClass("box-background");P=$("<div></div>").addClass("layout-horizontal");P.append(R);Q.append(P);Q.append($("<div></div>").addClass("layout-vertical"));Q.appendTo(J);Q.on("click",function(S){if(S.currentTarget!=S.target){return}F.close()});return Q}this.open=function(P,Q){K();if(M){I.push({node:M.node,close:M.close})}h.bodyManagement.expand();M={node:L(P),close:Q};M.node.stop(true,true);M.node.fadeIn(200)};this.close=function(Q,P){N(Q,P)};this.clear=function(){if(!M){return}h.bodyManagement.shrink();if(M.close){M.close()}M.node.remove();while(I.length>0){M=I.pop();h.bodyManagement.shrink();if(M.close){M.close()}M.node.remove()}M=null}};this.dialog=new function(){function I(){var J=$("<div></div>").addClass("dialog-box").addClass("box-panel");this.setHead=function(K){var L=$("<div></div>").addClass("dialog-header");L.append($("<h4></h4>").text(K));J.append(L)};this.setBody=function(L){var K=$("<div></div>").addClass("dialog-body");if(L.indexOf("\n")>-1){$.each(L.split("\n"),function(M,N){K.append($("<p></p>").text(N))})}else{K.text(L)}J.append(K)};this.setFooter=function(){var L=$("<div></div>").addClass("dialog-footer");function K(M){this.set=function(O){var P,N=$("<button></button>").text(O);N.click(function(Q){d.close(Q,function(){if(P){P()}})});M.append(N);return new function(){this.setCallback=function(Q){P=Q}}}}J.append(L);return new K(L)};this.get=function(K){J.data("type",K);return J};this.getElement=function(){return J}}this.alert=function(M,N,L){var O,J=new I();function K(P){this.onConfirm=function(Q){console.warn("onConfirm is obsolete. commend use ok");P.setCallback(Q);return this};this.ok=function(Q){P.setCallback(Q);return this}}if(typeof N=="function"){L=N;N=null}if(N){J.setHead(N)}J.setBody(M);O=J.setFooter().set(b.ok);if(L){console.warn("fn is obsolete. commend use ok");O.setCallback(L)}d.open(J.get("alert"));return new K(O)};this.confirm=function(O,Q,P,L){var J,K,R,N=new I();function M(T,S){this.onConfirm=function(U){console.warn("onConfirm is obsolete. commend use yes");T.setCallback(U);return this};this.yes=function(U){T.setCallback(U);return this};this.onCancel=function(U){console.warn("onCancel is obsolete. commend use no");S.setCallback(U);return this};this.no=function(U){S.setCallback(U);return this}}if(typeof Q=="function"){L=P;P=Q;Q=null}if(Q){N.setHead(Q)}N.setBody(O);R=N.setFooter();J=R.set(b.yes,P);if(P){console.warn("fnYes is obsolete.");J.setCallback(P)}K=R.set(b.no,L);if(L){console.warn("fnNo is obsolete.");K.setCallback(L)}d.open(N.get("confirm"));return new M(J,K)};this.message=function(K){var J=new I();J.setBody(K);d.open(J.get("message"));return new function(){this.close=function(L){d.close(null,L)};this.change=function(L){J.getElement().find(".dialog-body").text(L)}}}};this.loadingTip=new function(){var I;function J(){if(I!=null){return}I=$("<div></div>").addClass("loading-background").addClass("box-background");var K=$("<div></div>").addClass("loading-box").addClass("box-panel"),L=$("<span></span>").text(b.loading);K.append(L);I.append($("<div></div>").addClass("layout-horizontal").append(K)).append($("<div></div>").addClass("layout-vertical"));I.prependTo($("body"))}this.show=function(){J();h.bodyManagement.expand();I.stop(true,true);I.fadeIn(o.loading_show_time);return new function(){this.hide=function(){h.loadingTip.hide()}}};this.hide=function(){J();I.stop(true);I.fadeOut(o.loading_hide_time,function(){h.bodyManagement.shrink()})}};this.linker=new function(){var I=false,N=null,L=null,O=null;function J(P){if(!P){return P}if(P.substr(0,1)=="#"){return P.substr(1)}return P}function M(){L(N)}function K(){var P=new w(window.location.hash).getContent();if(N==P){return}N=P;M()}this.setChangeCompleted=function(P){O=P};this.callChangeCompleted=function(P){if(!O){return}O(P);O=null};this.modify=function(P){window.location.hash=P;N=new w(P).getContent()};this.hash=function(P){if(P==undefined){return window.location.hash}window.location.hash=P;if(P==N){M()}return P};this.link=function(P){if(P==undefined){return i.get().getLink()}P=B(P);window.location.hash=P;if(P==N){M()}};this.add=function(P){var Q=new w(window.location.hash);Q.push(P);window.location.hash=Q.getContent()};this.same=function(P){var Q=new w(window.location.hash);Q.pop();Q.push(P);window.location.hash=Q.getContent();if(Q.getContent()==N){M()}};this.refresh=function(){M()};this._init=function(P){if(I){return}I=true;L=P;N=J(window.location.hash);if("onhashchange" in window){window.onhashchange=K}else{window.setInterval(function(){if(N!=J(window.location.hash)){K()}},100)}M()}};function C(){var I=new p(),L;function K(P,Q,N,R,M){var O;if(I.count()==0){i.push(F)}I.push("modal",P,{closed:L.closed,data:Q,type:N});O=I.last();O.node.addClass("box-panel");if(M==undefined){O.setContext(R)}else{O.setContext(R,M)}z.open(O.node,function(){O.remove()});O.callLoadAndActive()}function J(O,M){if(I.count()==0){return}var N=I.last();N.callInactiveAndUnload();if(M==undefined){N.setContext(O)}else{N.setContext(O,M)}N.callLoadAndActive()}this.load=function(O,P,N){var Q=h.loadingTip.show(),M;M=v(O,f(I.getLinks(),I.count()-2,x.getDefaultLink()),x.getDefaultLink());$.ajax({mimeType:"text/html; charset="+o.server_charset,url:M,data:P,type:N,timeout:o.timeover}).done(function(U,V,T){Q.hide();var R=T.getResponseHeader("X-Responded-JSON"),S;if(R){S=JSON.parse(R);if(S.status==401){if(!a(S.headers.location)){if(S.headers&&S.headers.location){document.location=S.headers.location}}return}}if(n(U)){alert("You try to load wrong content: "+M);return}if(L.refresh){J(U)}else{K(O,P,N,U)}if(L.loaded){L.loaded()}}).fail(function(T,W,U){Q.hide();if(T.status==401){a(O)}var R=$(T.responseText),V=$("<h4></h4>").text(U),S=$("<pre></pre>");if(R[11]!=null&&R[11].nodeType==8){S.text(R[11].data)}else{S.text(R.eq(1).text())}if(L.refresh){J(V,S)}else{K(O,P,N,V,S)}});L={closed:null,loaded:null,link:O,data:P,type:N,refresh:false};return L};this.reload=function(){var N=I.last().getOption(),M=this.load(I.last().link,N.data,N.type);M.refresh=true};this.close=function(O,M){var N=I.pop().getOption().closed;z.close(null,function(){var P=I.last();if(!P){i.pop()}if(N){N(O)}if(M){M(false)}})};this.replace=function(N,O){var M=I.last();M.callInactiveAndUnload();M.link=N;M.setContext(O);M.callLoadAndActive()};this.clear=function(){z.clear();if(I.count()>0){I=new p();i.pop()}};this.getNode=function(){return I.last().node};this.getLink=function(){return I.last().link}}function G(){var I=new p(),L;function K(P,Q,N,R,M){var O;if(I.count()>0){I.last().hide()}else{x.inactiveCurrent();i.push(A)}I.push("open",P,{closed:L.closed,data:Q,type:N});O=I.last();if(M==undefined){O.setContext(R)}else{O.setContext(R,M)}r.open(O.node,function(){O.remove()});O.callLoadAndActive()}function J(O,M){if(I.count()==0){return}var N=I.last();N.callInactiveAndUnload();if(M==undefined){N.setContext(O)}else{N.setContext(O,M)}N.callLoadAndActive()}this.load=function(O,P,N){var Q=h.loadingTip.show(),M;F.clear();M=v(O,f(I.getLinks(),I.count()-2,x.getDefaultLink()),x.getDefaultLink());$.ajax({mimeType:"text/html; charset="+o.server_charset,url:M,data:P,type:N,timeout:o.timeover}).done(function(U,V,T){Q.hide();var R=T.getResponseHeader("X-Responded-JSON"),S;if(R){S=JSON.parse(R);if(S.status==401){if(!a(S.headers.location)){if(S.headers&&S.headers.location){document.location=S.headers.location}}return}}if(n(U)){alert("You try to load wrong content: "+M);return}if(L.refresh){J(U)}else{K(O,P,N,U)}if(L.loaded){L.loaded()}}).fail(function(T,W,U){Q.hide();if(T.status==401){a(O)}var R=$(T.responseText),V=$("<h4></h4>").text(U),S=$("<pre></pre>");if(R[11]!=null&&R[11].nodeType==8){S.text(R[11].data)}else{S.text(R.eq(1).text())}if(L.refresh){K(V,S)}else{J(O,P,N,V,S)}});L={closed:null,loaded:null,link:O,data:P,type:N,refresh:false};return L};this.reload=function(){var N=I.last().getOption(),M=this.load(I.last().link,N.data,N.type);M.refresh=true};this.close=function(O,M){var N=I.pop().getOption().closed;r.close(null,function(){var P=I.last();if(P){P.show()}else{i.pop();x.activeCurrent()}if(N){N(O)}if(M){M(false)}})};this.replace=function(N,O){var M=I.last();M.callInactiveAndUnload();M.link=N;M.setContext(O);M.callLoadAndActive()};this.clear=function(){r.clear();if(I.count()>0){I=new p();i.pop()}};this.getNode=function(){return I.last().node};this.getLink=function(){return I.last().link}}function m(P,O){var J=0,L=null,M=O,Q=new p(),I=true;function K(T,R){var S;S=Q.last();if(R==undefined){S.setContext(T)}else{S.setContext(T,R)}S.callLoadAndActive();h.resetWindowScrollbar();$(window).scrollTop(0);h.dealScrollToVisibleLoading()}function N(T,V,W,U){var R=++J,X=h.loadingTip.show(),S=v(T,V,M);if(q){X.hide();X=null;q=false}$.ajax({mimeType:"text/html; charset="+o.server_charset,url:S,type:"GET",timeout:o.timeover}).done(function(ab,ac,aa){if(R!=J){return}if(X){X.hide()}var Y=aa.getResponseHeader("X-Responded-JSON"),Z;if(Y){Z=JSON.parse(Y);if(Z.status==401){if(!a(Z.headers.location)){if(Z.headers&&Z.headers.location){document.location=Z.headers.location}}return}}if(n(ab)){alert("You try to load wrong content: "+S);return}W();K(ab);if(U){U(true)}}).fail(function(aa,ad,ab){if(R!=J){return}if(X){X.hide()}if(aa.status==401){a(S)}var Y=$(aa.responseText),ac=$("<h4></h4>").text(ab),Z=$("<pre></pre>");if(Y[11]!=null&&Y[11].nodeType==8){Z.text(Y[11].data)}else{Z.text(Y.eq(1).text())}W();K(ac,Z)})}this.load=function(S,T){var U,R;if(L==null){L=$(P)}if(L.is("body")){throw"viewNode can't be <body>"}U=new w(S).getLinks();F.clear();A.clear();d.clear();if(Q.count()>U.length&&Q.like(U)&&Q.get(U.length-1).valid){for(R=Q.count()-1;R>U.length-1;R--){Q.pop().remove()}Q.last().show();h.resetWindowScrollbar();if(T){T(false)}return}N(U[U.length-1],f(U,U.length-2,M),function(){var W,V;if(I){L.empty();I=false}if(Q.count()>U.length&&Q.like(U)){for(W=Q.count()-1;W>U.length-1;W--){Q.pop().remove()}}else{V=Q.count();for(W=V-1;W>U.length-1;W--){Q.pop().remove()}for(W=0;W<U.length;W++){if(V>W){if(Q.get(W).link!=U[W]||(V==W+1&&U.length==V)){Q.replace(W,"main",U[W],{baseLink:f(U,W-1,M)})}else{Q.get(W).hide()}}else{Q.push("main",U[W],{baseLink:f(U,W-1,M)});L.append(Q.last().node)}}}},T)};this.reload=function(){N(Q.last().link,Q.last().getOption().baseLink,function(){Q.last().callInactiveAndUnload()})};this.close=function(S,R){if(Q.count()>1){if(Q.get(Q.count()-2).valid){Q.pop().remove();h.linker.modify(Q.getLink());Q.last().show();h.resetWindowScrollbar();if(R){R(false)}}else{h.linker.setChangeCompleted(R);h.linker.hash(Q.getBackLink())}}};this.replace=function(S,T){var R=Q.last();R.callInactiveAndUnload();R.link=S;R.setContext(T);R.callLoadAndActive()};this.getElement=function(){return L};this.setElement=function(R){return L=$(R)};this.getDefaultLink=function(){return M};this.setDefaultLink=function(R){M=R};this.activeCurrent=function(){Q.last().activeEvent()};this.inactiveCurrent=function(){Q.last().inactiveEvent()};this.getLinks=function(){return Q.getLinks()};this.getNode=function(){return Q.last().node};this.getLink=function(){return Q.last().link}}this.current=function(){return{node:i.get().getNode(),link:i.get().getLink(),view:i.get()}};this.event=function(){return new function(){this.onLoad=function(I){y.load=I;return this};this.onUnload=function(I){y.unload=I;return this};this.onActive=function(I){y.active=I;return this};this.onInactive=function(I){y.inactive=I;return this}}};this.viewClose=function(J,I){i.get().close(J,I)};this.viewReload=function(){i.get().reload()};this.dealScrollToVisibleLoading=function(){var J=$(".webapp-loading:visible"),I;if(J.length>0&&!J.data("work")&&$(window).scrollTop()+$(window).height()>J.offset().top){J.data("work",true);I=J.attr("data-src");if(!I){return}$.get(I,function(K){J.before(K);J.remove();h.resetWindowScrollbar();h.dealScrollToVisibleLoading()})}};function l(L){var K,J,I=true;if($("body").hasClass("layout-expanded")){K=L.originalEvent.path;for(J=0;J<K.length;J++){if(K[J].tagName=="BODY"){break}if(K[J].scrollHeight>K[J].clientHeight){I=false;break}}if(I){L.preventDefault()}}}t={_base:function(I){h.linker.link(I)},_link:function(I){h.linker.link(I)},_add:function(I){h.linker.add(I)},_same:function(I){h.linker.same(I)},_open:function(I,J){h.open(I,J.attr("data-data"))},_modal:function(I,J){h.modal(I,J.attr("data-data"))}};this.configTarget=function(I){if(typeof I=="function"){I(t)}};this.hashes=function(){return x.getLinks()};this.open=function(I,K){var J;if(K){J=A.load(I,K,"POST")}else{J=A.load(I,K,"GET")}return new function(){this.closed=function(L){J.closed=L};this.loaded=function(L){J.loaded=L}}};this.modal=function(I,K){var J;if(K){J=F.load(I,K,"POST")}else{J=F.load(I,K,"GET")}return new function(){this.closed=function(L){J.closed=L};this.loaded=function(L){J.loaded=L}}};this.configSetting=function(I){if(typeof I=="function"){I(o)}};this.configText=function(I){if(typeof I=="function"){I(b)}};this.initialization=function(J,I){function K(L){this.viewNode=function(M){if(!M){return L.getElement()}L.setElement(M);return this};this.defaultLink=function(M){if(!M){return L.getDefaultLink()}L.setDefaultLink(M);return this};this.unauthorized=function(M){a=M;return this};this.dealLinkEmptyTarget=function(M){if(M==undefined){return D}D=M;return this};this.replacePCScrollBar=function(M){g=M;return this};this.viewLoaded=function(M){s.load=M;return this};this.viewActived=function(M){s.active=M;return this};this.viewInactived=function(M){s.inactive=M;return this};this.viewUnloaded=function(M){s.unload=M;return this}}if(!!window.ActiveXObject||"ActiveXObject" in window){$.ajaxSetup({cache:false})}$(document).on("click","a",function(N){var M=$(this).attr("target"),L=$(this).attr("href");if(L=="#"){N.preventDefault();return}if(!M){if(!D){return}N.preventDefault();t._link(L);return}if(M=="_none"){return}if(t[M]){N.preventDefault();t[M](L,$(this))}});$(document).on("click",".webapp-close",function(L){L.preventDefault();h.viewClose($(this).attr("data-close"))});$(window).on("scroll",h.dealScrollToVisibleLoading);$(window).on("resize",h.dealScrollToVisibleLoading);$(document).on("touchmove",l);s=new u();x=new m(J,I);A=new G();F=new C();i.push(x);return new K(x)};this.init=function(K,J){var I=h.initialization(K,J);h.linker._init(function(L){x.load(L,h.linker.callChangeCompleted)});return I};this.setup=function(K,J){if(e){e=false}else{throw"Has been setup"}var I=h.initialization(K,J);$(function(){h.linker._init(function(L){x.load(L,h.linker.callChangeCompleted)})});return I};this.setupLayout=function(K,M,L,J){if(e){e=false}else{throw"Has been setup"}var I=h.initialization(L,J);$(function(){$.ajax({mimeType:"text/html; charset="+o.server_charset,url:M,type:"GET",timeout:o.timeover}).done(function(Q,R,P){var N=P.getResponseHeader("X-Responded-JSON"),O;if(N){O=JSON.parse(N);if(O.status==401){if(!a(O.headers.location)){if(O.headers&&O.headers.location){document.location=O.headers.location}}return}}if(n(Q)){alert("You try to load wrong content: "+M);return}$(K).html(Q).children().unwrap();q=true;h.linker._init(function(S){x.load(S,h.linker.callChangeCompleted)})}).fail(function(N,P,O){if(N.status==401){a(M)}h.dialog.alert(b.load_layout_error,O).ok(function(){document.location.reload()})})});return I};window.$app={configSetting:h.configSetting,configText:h.configText,alert:h.dialog.alert,confirm:h.dialog.confirm,message:h.dialog.message,loading:h.loadingTip.show,loadScript:h.scriptLoader.load,hash:h.linker.hash,baseHash:h.linker.hash,addHash:h.linker.add,sameHash:h.linker.same,link:h.linker.link,add:h.linker.add,same:h.linker.same,open:h.open,modal:h.modal,event:h.event,reload:h.viewReload,close:h.viewClose,current:h.current,init:h.init,setup:h.setup,setupLayout:h.setupLayout}})();